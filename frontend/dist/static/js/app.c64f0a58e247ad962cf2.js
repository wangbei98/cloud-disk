webpackJsonp([1],{"0RuW":function(e,t){},"0baj":function(e,t){},"2vDZ":function(e,t){},"9M+g":function(e,t){},"9NRs":function(e,t){},AQnQ:function(e,t){},D9lA:function(e,t,o){e.exports=o.p+"static/img/img.77608c3.jpg"},EWrd:function(e,t){},FyRi:function(e,t){},Jmt5:function(e,t){},NHnr:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o("7+uW"),i={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[this.isRouterAlive?t("router-view"):this._e()],1)},staticRenderFns:[]};var l=o("VU/8")({name:"App",provide:function(){return{reload:this.reload}},data:function(){return{isRouterAlive:!0}},methods:{reload:function(){this.isRouterAlive=!1,this.$nextTick(function(){this.isRouterAlive=!0})}}},i,!1,function(e){o("FyRi")},null,null).exports,s=o("/ocq"),r={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("b-navbar",{staticClass:"nav-background",attrs:{toggleable:"lg",type:"dark"}},[o("b-navbar-brand",{attrs:{href:"#"}},[e._v("BytesCloud")]),e._v(" "),o("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),e._v(" "),o("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[o("b-navbar-nav",[o("b-nav-item",{attrs:{href:"#"}},[e._v("Link")]),e._v(" "),o("b-nav-item",{attrs:{href:"#",disabled:""}},[e._v("Disabled")])],1),e._v(" "),o("b-navbar-nav",{staticClass:"ml-auto"},[o("b-nav-form",[o("b-form-input",{staticClass:"mr-sm-2",attrs:{size:"sm",placeholder:"Search"}}),e._v(" "),o("b-button",{staticClass:"my-2 my-sm-0",attrs:{size:"sm",type:"submit"}},[e._v("Search")])],1),e._v(" "),o("b-nav-item-dropdown",{attrs:{text:"Lang",right:""}},[o("b-dropdown-item",{attrs:{href:"#"}},[e._v("EN")]),e._v(" "),o("b-dropdown-item",{attrs:{href:"#"}},[e._v("ES")]),e._v(" "),o("b-dropdown-item",{attrs:{href:"#"}},[e._v("RU")]),e._v(" "),o("b-dropdown-item",{attrs:{href:"#"}},[e._v("FA")])],1),e._v(" "),e.loggedIn?o("b-nav-item-dropdown",{attrs:{right:""},scopedSlots:e._u([{key:"button-content",fn:function(){return[o("em",[e._v(e._s(e.curEmail))])]},proxy:!0}],null,!1,4044761237)},[e._v(" "),o("b-dropdown-item",[o("router-link",{attrs:{to:{name:""}}},[e._v("Profile")])],1),e._v(" "),o("b-dropdown-item",[o("router-link",{attrs:{to:{name:"Logout"}}},[e._v("Sign Out")])],1)],1):e._e(),e._v(" "),e.loggedIn?e._e():o("b-navbar-nav",[o("b-nav-item",[o("router-link",{attrs:{to:{name:"Login"}}},[e._v("Login")])],1)],1)],1)],1)],1)],1)},staticRenderFns:[]};var a=o("VU/8")({name:"nav-header",computed:{loggedIn:function(){return this.$store.getters.loggedIn},curEmail:function(){return this.$store.getters.curEmail}}},r,!1,function(e){o("vMRt")},null,null).exports,c={data:function(){return{collapse:!1,fullscreen:!1,name:"AsunaCC"}},computed:{loggedIn:function(){return this.$store.getters.loggedIn},curEmail:function(){return this.$store.getters.curEmail}},methods:{handleCommand:function(e){"loginout"==e?this.$router.push("/logout"):"register"==e?this.$router.push("/register"):"login"==e&&this.$router.push("/login")},collapseChage:function(){this.collapse=!this.collapse},handleFullScreen:function(){var e=document.documentElement;this.fullscreen?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen(),this.fullscreen=!this.fullscreen}},mounted:function(){document.body.clientWidth<1500&&this.collapseChage()}},d={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"header"},[o("div",{staticClass:"collapse-btn",on:{click:e.collapseChage}},[o("i",{staticClass:"el-icon-cloudy"})]),e._v(" "),o("div",{staticClass:"logo"},[e._v("BytesCloud")]),e._v(" "),o("div",{staticClass:"header-right"},[o("div",{staticClass:"header-user-con"},[o("div",{staticClass:"btn-fullscreen",on:{click:e.handleFullScreen}},[o("el-tooltip",{attrs:{effect:"dark",content:e.fullscreen?"取消全屏":"全屏",placement:"bottom"}},[o("i",{staticClass:"el-icon-rank"})])],1),e._v(" "),e._m(0),e._v(" "),e.loggedIn?o("el-dropdown",{staticClass:"user-name",attrs:{trigger:"click"},on:{command:e.handleCommand}},[o("span",{staticClass:"el-dropdown-link",staticStyle:{color:"#2f3542"}},[e._v("\r\n                        "+e._s(e.curEmail)+"\r\n                        "),o("i",{staticClass:"el-icon-caret-bottom"})]),e._v(" "),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[o("a",{attrs:{href:"https:wangbei.xyz",target:"_blank"}},[o("el-dropdown-item",[e._v("访问博客")])],1),e._v(" "),o("el-dropdown-item",{attrs:{divided:"",command:"loginout"}},[e._v("退出登录")])],1)],1):o("el-dropdown",{staticClass:"user-name",attrs:{trigger:"click"},on:{command:e.handleCommand}},[o("span",{staticClass:"el-dropdown-link"},[e._v("\n                        注册/登录\n                        "),o("i",{staticClass:"el-icon-caret-bottom"})]),e._v(" "),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[o("el-dropdown-item",{attrs:{divided:"",command:"login"}},[e._v("登录")]),e._v(" "),o("el-dropdown-item",{attrs:{divided:"",command:"register"}},[e._v("注册")])],1)],1)],1)])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"user-avator"},[t("img",{attrs:{src:o("D9lA")}})])}]};var u=o("VU/8")(c,d,!1,function(e){o("0baj")},"data-v-91e81fc0",null).exports,h={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"sidebar"},[o("el-menu",{staticClass:"sidebar-el-menu",attrs:{"background-color":"#ffffff","text-color":"#2f3542","active-text-color":"#20a0ff","unique-opened":""}},[o("el-menu-item-group",[o("el-menu-item",{on:{click:e.goAllFiles}},[o("i",{staticClass:"el-icon-files"}),e._v(" "),o("span",{attrs:{slot:"title"},slot:"title"},[e._v("全部")])]),e._v(" "),o("el-menu-item",{on:{click:e.goDocs}},[o("i",{staticClass:"el-icon-document"}),e._v("\n            文档")]),e._v(" "),o("el-menu-item",{on:{click:e.goImgs}},[o("i",{staticClass:"el-icon-picture"}),e._v("\n            图片")]),e._v(" "),o("el-menu-item",{on:{click:e.goMusics}},[o("i",{staticClass:"el-icon-headset"}),e._v("\n            音乐")]),e._v(" "),o("el-menu-item",{on:{click:e.goVideos}},[o("i",{staticClass:"el-icon-video-camera-solid"}),e._v("\n            视频")]),e._v(" "),o("el-menu-item",{on:{click:e.goDemo}},[o("i",{staticClass:"el-icon-files"}),e._v("\n            demo")])],1)],1)],1)},staticRenderFns:[]};var m={components:{vHead:u,NavHeader:a,vSidebar:o("VU/8")({data:function(){return{}},computed:{},created:function(){},methods:{goAllFiles:function(){this.$router.push("/home/files"),this.$store.dispatch("clearCurPathItems")},goDocs:function(){this.$router.push("/home/doc")},goImgs:function(){this.$router.push("/home/img")},goMusics:function(){this.$router.push("/home/music")},goVideos:function(){this.$router.push("/home/video")},goTrash:function(){this.$router.push("/home")},goDemo:function(){this.$router.push("/home/demo")}}},h,!1,function(e){o("0RuW")},"data-v-6c8a990a",null).exports},created:function(){}},f={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"wrapper"},[t("v-head"),this._v(" "),t("v-sidebar"),this._v(" "),t("div",{staticClass:"content-box"},[t("router-view")],1)],1)},staticRenderFns:[]},p=o("VU/8")(m,f,!1,null,null,null).exports,g={name:"login",components:{vHead:u,NavHeader:a},data:function(){return{form:{email:"",password:"",checked:[]},show:!0}},methods:{onSubmit:function(e){var t=this;e.preventDefault(),this.$store.dispatch("login",{email:this.form.email,password:this.form.password}).then(function(e){console.log(e);var o=e.data.data.token;t.$store.dispatch("saveToken",o),t.$router.push("/home/files/-1"),t.$store.dispatch("getAllFiles")})},onReset:function(e){var t=this;e.preventDefault(),this.form.email="",this.form.password="",this.form.checked=[],this.show=!1,this.$nextTick(function(){t.show=!0})}}},v={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("v-head"),e._v(" "),o("b-container",[o("b-row",{staticClass:"mt-5",attrs:{"align-h":"center"}},[o("b-col",{attrs:{cols:"5"}},[o("b-card",{staticClass:"p-3"},[o("h3",{staticClass:"mb-4"},[e._v("Login")]),e._v(" "),e.show?o("b-form",{on:{submit:e.onSubmit,reset:e.onReset}},[o("b-form-group",{attrs:{id:"input-group-1",label:"Email address:","label-for":"input-1"}},[o("b-form-input",{attrs:{id:"input-1",type:"email",required:"",placeholder:"Enter email"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),e._v(" "),o("b-form-group",{attrs:{id:"input-group-2",label:"Password","label-for":"input-2"}},[o("b-form-input",{attrs:{id:"input-2",type:"password",required:"",placeholder:"Enter Password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),e._v(" "),o("b-form-group",{attrs:{id:"input-group-4"}},[o("b-form-checkbox-group",{attrs:{id:"checkboxes-4"},model:{value:e.form.checked,callback:function(t){e.$set(e.form,"checked",t)},expression:"form.checked"}},[o("b-form-checkbox",{attrs:{value:"remember"}},[e._v("Remenber me")])],1)],1),e._v(" "),o("div",{staticClass:"d-flex justify-content-between"},[o("div",[o("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("Submit")]),e._v(" \n                  "),o("b-button",{attrs:{type:"reset",variant:"danger"}},[e._v("Reset")])],1),e._v(" "),o("div",[o("router-link",{attrs:{to:{name:"Register"}}},[e._v("Register")])],1)])],1):e._e()],1)],1)],1)],1)],1)},staticRenderFns:[]};var b=o("VU/8")(g,v,!1,function(e){o("AQnQ")},null,null).exports,_={render:function(){var e=this.$createElement;return(this._self._c||e)("div")},staticRenderFns:[]};var w=o("VU/8")({created:function(){var e=this;this.$store.dispatch("logout").then(function(t){e.$router.push("/")})}},_,!1,function(e){o("uEG4")},null,null).exports,y={name:"login",components:{vHead:u,NavHeader:a},data:function(){return{form:{email:"",password:"",checked:[]},show:!0}},methods:{onSubmit:function(e){var t=this;e.preventDefault(),this.$store.dispatch("register",{email:this.form.email,password:this.form.password}).then(function(e){t.$router.push("/login")})},onReset:function(e){var t=this;e.preventDefault(),this.form.email="",this.form.password="",this.form.checked=[],this.show=!1,this.$nextTick(function(){t.show=!0})}}},F={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("v-head"),e._v(" "),o("b-container",[o("b-row",{staticClass:"mt-5",attrs:{"align-h":"center"}},[o("b-col",{attrs:{cols:"5"}},[o("b-card",{staticClass:"p-3"},[o("h3",{staticClass:"mb-4"},[e._v("Register")]),e._v(" "),e.show?o("b-form",{on:{submit:e.onSubmit,reset:e.onReset}},[o("b-form-group",{attrs:{id:"input-group-1",label:"Email address:","label-for":"input-1"}},[o("b-form-input",{attrs:{id:"input-1",type:"email",required:"",placeholder:"Enter email"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),e._v(" "),o("b-form-group",{attrs:{id:"input-group-2",label:"Password","label-for":"input-2"}},[o("b-form-input",{attrs:{id:"input-2",type:"password",required:"",placeholder:"Enter Password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),e._v(" "),o("div",{staticClass:"d-flex justify-content-between"},[o("div",[o("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("Submit")]),e._v(" \n                  "),o("b-button",{attrs:{type:"reset",variant:"danger"}},[e._v("Reset")])],1)])],1):e._e()],1)],1)],1)],1)],1)},staticRenderFns:[]};var k=o("VU/8")(y,F,!1,function(e){o("j1r9")},null,null).exports,S={name:"home",props:{shareUrl:{type:String,required:!0}},components:{vHead:u},data:function(){return{file:null,shareToken:""}},created:function(){var e=this;this.$store.dispatch("getShareFileInfo",this.shareUrl).then(function(t){console.log("mounted -> getShareFileInfo -> res"),console.log(t),e.file=t.data.data.file,console.log("this.file:"),console.log(e.file)}).catch(function(e){console.log(e)})},methods:{handleDownloadShare:function(){var e=this;this.$store.dispatch("downloadShare",{shareUrl:this.shareUrl,shareToken:this.shareToken}).then(function(t){if(console.log("in handleDownloadShare -> res:"),console.log(t),"application/json"===t.data.type)e.$message({type:"error",message:"下载失败，文件不存在或权限不足"});else if(window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(blob,e.file.fileName);else{var o=window.URL.createObjectURL(new Blob([t.data])),n=document.createElement("a");n.style.display="none",n.href=o,n.setAttribute("download",e.file.filename),document.body.appendChild(n),n.click()}e.$message({message:"下载成功",type:"success"})}).catch(function(t){console.log(t),e.$message.error("下载失败，请刷新后重试")})}}},$={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("v-head"),e._v(" "),o("b-container",[o("b-row",{staticClass:"mt-5",attrs:{"align-h":"center"}},[o("b-col",{attrs:{cols:"5"}},[null!=e.file?o("b-card",{staticClass:"p-3"},[o("h3",{staticClass:"mb-4"},[e._v("获取文件")]),e._v(" "),o("div",[o("p",[e._v(e._s(e.file.filename))])]),e._v(" "),o("br"),e._v(" "),o("el-row",[o("el-col",{attrs:{span:12}},[o("el-input",{attrs:{placeholder:"请输入密码","show-password":""},model:{value:e.shareToken,callback:function(t){e.shareToken=t},expression:"shareToken"}})],1),e._v(" "),o("el-col",{attrs:{span:12}},[o("el-button",{attrs:{type:"primary",plain:""},on:{click:e.handleDownloadShare}},[e._v("下载")])],1)],1)],1):o("b-card",{staticClass:"p-3"},[o("h4",{staticClass:"mb-4"},[e._v("该分享链接已失效")])])],1)],1)],1)],1)},staticRenderFns:[]};var C=o("VU/8")(S,$,!1,function(e){o("j18t")},null,null).exports,x={name:"file-item",props:{file:{type:Object,required:!0}},data:function(){return{filename:this.file.filename,id:this.file.id,parent_id:this.file.parent_id,path_root:this.file.path_root,size:this.file.size,type_of_node:this.file.type_of_node,upload_time:this.file.upload_time,editing:!1,beforeEditCache:""}},directives:{focus:{inserted:function(e){e.focus()}}},computed:{type:function(){return"JPG"==this.type_of_node||"jpg"==this.type_of_node||"JPEG"==this.type_of_node||"jpeg"==this.type_of_node||"PNG"==this.type_of_node||"png"==this.type_of_node||"GIF"==this.type_of_node||"gif"==this.type_of_node?"img":"mp3"==this.type_of_node||"wav"==this.type_of_node||"wma"==this.type_of_node||"rm"==this.type_of_node||"m4a"==this.type_of_node?"music":"flv"==this.type_of_node||"avi"==this.type_of_node||"mov"==this.type_of_node||"mp4"==this.type_of_node||"wmv"==this.type_of_node?"video":"dir"==this.type_of_node?"dir":"doc"},previewURL:function(){return this.$store.getters.targetHost+"/api/file/preview?id="+this.id+"&width=50&height=50&token="+this.$store.getters.token},previewSRC:function(){return this.$store.getters.targetHost+"/api/file/preview?id="+this.id+"&width=800&height=800&token="+this.$store.getters.token}},methods:{clickInto:function(e,t){console.log(e,t),"dir"==t?(console.log("dispath to changecurfileid",e),this.$router.push({path:"/home/files/"+e}),this.$store.dispatch("changeCurFileID",e),this.$store.dispatch("changePathItems",e)):console.log("预览文件",e)},editFilename:function(){this.beforeEditCache=this.filename,this.editing=!0},doneEdit:function(){0!=this.filename.trim().length?(this.editing=!1,this.$store.dispatch("finishedEdit",{id:this.id,newName:this.filename}),this.$store.dispatch("getAllFiles"),console.log("done edit")):this.filename=this.beforeEditCache},cancelEdit:function(){this.filename=this.beforeEditCache,this.editing=!1}},filters:{cutString:function(e,t){var o=/[\u4e00-\u9fa5]/g,n=e.substring(0,t),i=~~(n.match(o)&&n.match(o).length),l=2*n.length-i;return e.substr(0,l)+(l<e.length?"...":"")}}},T={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticStyle:{width:"80px",margin:"20px"}},[e._t("default"),e._v(" "),o("b-col",{attrs:{l:"4"}},["dir"==e.type?o("div",{staticStyle:{"font-size":"60px"},on:{click:function(t){return e.clickInto(e.id,e.type_of_node)}}},[o("i",{staticClass:"el-icon-folder-opened",staticStyle:{color:"#324157"}})]):"img"==e.type?o("div",{staticStyle:{"font-size":"60px"}},[o("el-image",{staticStyle:{width:"60px",height:"60px"},attrs:{src:e.previewURL,"preview-src-list":[e.previewSRC],fit:"contain"}})],1):"video"==e.type?o("div",{staticStyle:{"font-size":"60px"},on:{click:function(t){return e.clickInto(e.id,e.type_of_node)}}},[o("i",{staticClass:"el-icon-video-camera",staticStyle:{color:"#324157"}})]):"music"==e.type?o("div",{staticStyle:{"font-size":"60px"},on:{click:function(t){return e.clickInto(e.id,e.type_of_node)}}},[o("i",{staticClass:"el-icon-headset",staticStyle:{color:"#324157"}})]):"doc"==e.type?o("div",{staticStyle:{"font-size":"60px"},on:{click:function(t){return e.clickInto(e.id,e.type_of_node)}}},[o("i",{staticClass:"el-icon-document",staticStyle:{color:"#324157"}})]):e._e(),e._v(" "),e.editing?o("input",{directives:[{name:"model",rawName:"v-model",value:e.filename,expression:"filename"},{name:"focus",rawName:"v-focus"}],staticClass:"todo-item-edit",attrs:{type:"text"},domProps:{value:e.filename},on:{blur:e.doneEdit,keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doneEdit(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.cancelEdit(t)}],input:function(t){t.target.composing||(e.filename=t.target.value)}}}):o("div",{staticStyle:{width:"60px","text-align":"center"},on:{dblclick:e.editFilename}},[e._v("\n        "+e._s(e._f("cutString")(e.filename,4))+"\n      ")])])],2)},staticRenderFns:[]};var I=o("VU/8")(x,T,!1,function(e){o("EWrd")},null,null).exports,L={name:"file-container",props:{id:{type:String,required:!0}},inject:["reload"],data:function(){return{newFile:"",file:null,checkAll:!1,isIndeterminate:!0,newFolderTab:!0,uploadTab:!1,selected:[],shareForm:{id:-1,token_required:0,day:1},dialogFormVisible:!1,dialogTableVisible:!1,formLabelWidth:"120px",shares:[],multipleSelection:[]}},components:{FileItem:I},created:function(){console.log("created FileContainer"),this.$store.dispatch("getAllFiles"),console.log("this.id",this.id),this.$store.dispatch("changeCurFileID",this.id)},computed:{curFileList:function(){return this.$store.getters.curFileList},pathItems:function(){return console.log("computed pathItems"),console.log(this.$store.getters.curPathItems),this.$store.getters.curPathItems},anyRemaining:function(){return this.$store.getters.anyRemaining},selectedLength:function(){return this.selected.length}},methods:{changeCurFileID:function(e,t){this.$store.dispatch("changeCurFileID",e),this.$store.dispatch("changePathItems",e),this.$router.push(t).catch(function(e){}),this.emptyChecked()},commitNew:function(){var e=this;this.$store.dispatch("commitNew",{curID:this.id,newFile:this.newFile}).then(function(t){e.$message({message:"新建成功",type:"success"}),e.reload()}),this.$store.dispatch("getAllFiles")},cancelNew:function(){this.newFile=""},clickNewFolderTab:function(){this.newFolderTab=!0,this.uploadTab=!1},clickUploadTab:function(){this.newFolderTab=!1,this.uploadTab=!0},submitUpload:function(){var e=this;this.file&&(console.log("submitUpload:"),console.log(this.id),console.log(this.file),this.$store.dispatch("submitUpload",{curID:this.id,file:this.file}).then(function(t){e.$message({message:"上传成功",type:"success"}),e.reload()}).toLocaleString(function(e){}))},handleCheckAllChange:function(e){this.selected=e?this.curFileList:[],this.isIndeterminate=!1},handleSelectedChange:function(e){var t=e.length;this.checkAll=t===this.curFileList.length,this.isIndeterminate=t>0&&t<this.curFileList.length},handleDownload:function(){var e=this;console.log("in handleDownload"),this.selected.forEach(function(t){return e.$store.dispatch("downloadFile",t.id).then(function(o){if(console.log("in handleDownload -> res:"),console.log(o),"application/json"===o.data.type)e.$message({type:"error",message:"下载失败，文件不存在或权限不足"});else if(window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(blob,t.fileName);else{var n=window.URL.createObjectURL(new Blob([o.data])),i=document.createElement("a");i.style.display="none",i.href=n,i.setAttribute("download",t.filename),document.body.appendChild(i),i.click()}e.$message({message:"下载成功",type:"success"})}).catch(function(t){console.log(t),e.$message.error("下载失败，请刷新后重试")})})},handleDelete:function(){var e=this;console.log("in handleDelete"),this.selected.forEach(function(t){return e.$store.dispatch("deleteFile",t.id).then(function(t){e.$message({message:"删除成功",type:"success"}),e.reload()}).catch(function(t){e.$message.error("删除失败，请刷新后重试")})})},handleShare:function(){if(this.selected.length>1)this.$message.error("只能选中一个");else{var e=this.selected[0];"dir"==e.type_of_node?this.$message.error("暂时不支持分享目录"):(this.shareForm.id=e.id,this.dialogFormVisible=!0)}},newShare:function(){var e=this;this.dialogFormVisible=!1,this.$store.dispatch("shareFile",this.shareForm).then(function(t){console.log("new share success -> res: "),console.log(t);var o=t.data.data.share.share_url,n=t.data.data.share.share_token;console.log(o),console.log(n),e.$message({message:"分享成功",type:"sucess"}),e.reload()}).catch(function(t){e.$message.error("分享失败")})},handleShowShare:function(){if(this.selected.length>1)this.$message.error("只能选中一个");else{var e=this.selected[0];if("dir"==e)this.$message.error("暂时不支持分享目录");else{var t=e.shares;this.shares=t,console.log("method : handleShowShare -> this.shares: "),console.log(this.shares),this.dialogTableVisible=!0}}},toggleSelection:function(e){var t=this;e?(console.log("in toggleSelection -> rows"),console.log(e),e.forEach(function(e){t.$refs.multipleTable.toggleRowSelection(e)})):(console.log("in toggleSelection -> not rows"),console.log(e),this.$refs.multipleTable.clearSelection())},handleSelectionChange:function(e){this.multipleSelection=e},handleDeleteShare:function(){var e=this;console.log(this.multipleSelection),this.multipleSelection.forEach(function(t){return e.$store.dispatch("deleteShare",t.share_id).then(function(t){e.$message({message:"删除成功",type:"sucess"}),e.reload()}).catch(function(t){e.$message.error("删除失败")})})},beginTimeFormatter:function(e,t){return new Date(1e3*parseInt(e.share_begin_time)).toLocaleString().replace(/:\d{1,2}$/," ")},endTimeFormatter:function(e,t){return new Date(1e3*parseInt(e.share_end_time)).toLocaleString().replace(/:\d{1,2}$/," ")},URLFormatter:function(e,t){return"http://bytescloud.cn/share/"+e.share_url}}},D={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"file-container"},[o("div",[o("b-card",{attrs:{title:"Card Title","no-body":""}},[o("b-card-header",{attrs:{"header-tag":"nav"}},[o("b-nav",{attrs:{"card-header":"",tabs:""}},[o("b-nav-item",{attrs:{active:e.newFolderTab},on:{click:e.clickNewFolderTab}},[e._v("新建文件夹")]),e._v(" "),o("b-nav-item",{attrs:{active:e.uploadTab},on:{click:e.clickUploadTab}},[e._v("上传文件")])],1)],1),e._v(" "),o("b-card-body",{staticClass:"text-center"},[e.newFolderTab?o("div",[o("b-button-toolbar",{attrs:{"aria-label":"Toolbar with button groups and input groups"}},[e._v("\n             \n            "),o("b-input-group",{attrs:{size:"sm"}},[o("b-form-input",{staticClass:"text-right",attrs:{placeholder:"新建文件夹"},model:{value:e.newFile,callback:function(t){e.newFile=t},expression:"newFile"}})],1),e._v("\n             \n            "),o("b-button-group",{staticClass:"mr-1",attrs:{size:"sm"}},[o("b-button",{on:{click:e.commitNew,keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.commitNew(t)}}},[e._v("Commit")]),e._v("\n               \n              "),o("b-button",{on:{click:e.cancelNew,keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.cancelNew(t)}}},[e._v("Cancel")])],1)],1)],1):e._e(),e._v(" "),e.uploadTab?o("div",[o("div",[o("b-form-file",{attrs:{state:Boolean(e.file),placeholder:"Choose a file or drop it here...","drop-placeholder":"Drop file here..."},model:{value:e.file,callback:function(t){e.file=t},expression:"file"}}),e._v(" "),o("div",{staticClass:"mt-3"},[e._v("Selected file: "+e._s(e.file?e.file.name:""))])],1),e._v(" "),o("b-button",{attrs:{variant:"primary"},on:{click:e.submitUpload}},[e._v("上传")])],1):e._e()])],1)],1),e._v(" "),o("br"),e._v(" "),o("el-container",{staticStyle:{height:"500px",border:"1px solid #eee"}},[o("el-aside",{staticStyle:{"background-color":"rgb(238, 241, 246)"},attrs:{width:"200px"}},[o("el-menu",{attrs:{"default-openeds":["1","3"]}},[o("el-submenu",{attrs:{index:"1"}},[o("el-menu-item-group",[o("el-menu-item",{attrs:{index:"3-1"}},[e._v("全部")]),e._v(" "),o("el-menu-item",{attrs:{index:"3-2"}},[e._v("文档")]),e._v(" "),o("el-menu-item",{attrs:{index:"3-3"}},[e._v("视频")]),e._v(" "),o("el-menu-item",{attrs:{index:"3-4"}},[e._v("图片")]),e._v(" "),o("el-menu-item",{attrs:{index:"3-5"}},[e._v("音乐")]),e._v(" "),o("el-menu-item",{attrs:{index:"3-6"}},[e._v("回收站")])],1)],1)],1)],1),e._v(" "),o("el-container",[o("b-breadcrumb",e._l(e.pathItems,function(t){return o("b-breadcrumb-item",{key:t.to.id,attrs:{text:t.text},on:{click:function(o){return e.changeCurFileID(t.to.id,t.to.path)}}})}),1),e._v(" "),o("el-header",{staticStyle:{"text-align":"right","font-size":"12px"}},[o("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"end"}},[o("el-col",{attrs:{span:6}},[e.selectedLength>0?o("el-button",{attrs:{type:"text"},on:{click:e.handleShowShare}},[e._v("查看分享链接")]):e._e()],1),e._v(" "),o("el-col",{attrs:{span:6}},[e.selectedLength>0?o("el-button",{attrs:{type:"text"},on:{click:e.handleShare}},[e._v("分享")]):e._e()],1),e._v(" "),o("el-col",{attrs:{span:6}},[e.selectedLength>0?o("el-button",{attrs:{type:"text"},on:{click:e.handleDownload}},[e._v("下载")]):e._e()],1),e._v(" "),o("el-col",{attrs:{span:6}},[e.selectedLength>0?o("el-button",{attrs:{type:"text"},on:{click:e.handleDelete}},[e._v("删除")]):e._e()],1),e._v(" "),o("el-col",{attrs:{span:6}},[o("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")])],1),e._v(" "),o("el-col",{attrs:{span:6}},[o("span",{staticStyle:{"font-size":"15px"}},[e._v(e._s(e.selectedLength)+" items selected")])])],1)],1),e._v(" "),o("el-main",[o("el-checkbox-group",{on:{change:e.handleSelectedChange},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.curFileList,function(e){return o("el-checkbox",{key:e.id,attrs:{label:e}},[o("file-item",{attrs:{file:e}})],1)}),1)],1)],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"分享文件",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[o("el-form",{attrs:{model:e.shareForm}},[o("el-form-item",{attrs:{label:"是否需要密码","label-width":e.formLabelWidth}},[o("el-radio",{attrs:{label:"0"},model:{value:e.shareForm.token_required,callback:function(t){e.$set(e.shareForm,"token_required",t)},expression:"shareForm.token_required"}},[e._v("不需要")]),e._v(" "),o("el-radio",{attrs:{label:"1"},model:{value:e.shareForm.token_required,callback:function(t){e.$set(e.shareForm,"token_required",t)},expression:"shareForm.token_required"}},[e._v("需要")])],1),e._v(" "),o("el-form-item",{attrs:{label:"失效时间","label-width":e.formLabelWidth}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:e.shareForm.day,callback:function(t){e.$set(e.shareForm,"day",t)},expression:"shareForm.day"}})],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.newShare}},[e._v("确 定")])],1)],1),e._v(" "),o("el-dialog",{attrs:{width:"70%",title:"已经分享的链接",visible:e.dialogTableVisible},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[o("el-table",{ref:"multipleTable",attrs:{data:e.shares,"max-height":"400","default-sort":{prop:"share_begin_time",order:"descending"}},on:{"selection-change":e.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),o("el-table-column",{attrs:{sortable:"",property:"share_begin_time",label:"开始日期",formatter:e.beginTimeFormatter,width:"150"}}),e._v(" "),o("el-table-column",{attrs:{sortable:"",property:"share_end_time",label:"失效日期",formatter:e.endTimeFormatter,width:"150"}}),e._v(" "),o("el-table-column",{attrs:{property:"share_url",label:"链接",formatter:e.URLFormatter,width:"400"}}),e._v(" "),o("el-table-column",{attrs:{property:"share_token",label:"密钥"}})],1),e._v(" "),o("div",{staticStyle:{"margin-top":"20px"}},[o("el-button",{on:{click:function(t){return e.toggleSelection()}}},[e._v("取消选择")]),e._v(" "),o("el-button",{on:{click:function(t){return e.handleDeleteShare()}}},[e._v("删除链接")])],1)],1)],1)},staticRenderFns:[]};var E,R=o("VU/8")(L,D,!1,function(e){o("odLO")},null,null).exports,V=o("bOdI"),U=o.n(V),N=(E={name:"all-files",components:{},props:{id:{type:String,required:!0}},inject:["reload"],data:function(){var e;return e={checkAll:!1,isIndeterminate:!0,newFolderTab:!0,uploadTab:!1,selected:[],shareForm:{id:-1,token_required:0,day:1},newFolderForm:{newFolderName:""},file:null,formLabelWidth:"120px",dialogFormVisible:!1,dialogTableVisible:!1,dialogNewFolderFormVisible:!1,dialogUploadFormVisible:!1},U()(e,"formLabelWidth","120px"),U()(e,"shares",[]),U()(e,"multipleSelection",[]),U()(e,"nameType",""),U()(e,"timeType","primary"),U()(e,"sortType","time"),e}},U()(E,"components",{FileItem:I}),U()(E,"created",function(){console.log("created FileContainer"),this.$store.dispatch("getAllFiles"),console.log("this.id",this.id),this.$store.dispatch("changeCurFileID",this.id)}),U()(E,"mounted",function(){console.log("mounted")}),U()(E,"computed",{curFileList:function(){return console.log("computed curFileList"),"name"==this.sortType?(console.log("sortType == name"),this.$store.getters.curFileList.sort(function(e,t){return e.filename>t.filename?1:-1})):"time"==this.sortType?(console.log("sortType == time"),this.$store.getters.curFileList.sort(function(e,t){return e.upload_time-t.upload_time})):void 0},pathItems:function(){return console.log("computed pathItems"),console.log(this.$store.getters.curPathItems),this.$store.getters.curPathItems},anyRemaining:function(){return this.$store.getters.anyRemaining},selectedLength:function(){return this.selected.length}}),U()(E,"methods",{handleNameSort:function(){this.nameType="primary",this.timeType="",this.sortType="name",console.log(this.sortType)},handleTimeSort:function(){this.nameType="",this.timeType="primary",this.sortType="time",console.log(this.sortType)},changeCurFileID:function(e,t){this.$store.dispatch("changeCurFileID",e),this.$store.dispatch("changePathItems",e),this.$router.push(t).catch(function(e){})},commitNew:function(){var e=this;this.$store.dispatch("commitNew",{curID:this.id,newFile:this.newFolderForm.newFolderName}).then(function(t){e.$message({message:"新建成功",type:"success"}),e.reload()}),this.$store.dispatch("getAllFiles")},cancelNew:function(){this.newFile=""},submitUpload:function(){var e=this;this.file&&(console.log("submitUpload:"),console.log(this.id),console.log(this.file),this.$store.dispatch("submitUpload",{curID:this.id,file:this.file}).then(function(t){e.$message({message:"上传成功",type:"success"}),e.reload()}).toLocaleString(function(e){}))},handleClose:function(e){this.$confirm("确认关闭？").then(function(t){e()}).catch(function(e){})},handleCheckAllChange:function(e){this.selected=e?this.curFileList:[],this.isIndeterminate=!1},handleSelectedChange:function(e){var t=e.length;this.checkAll=t===this.curFileList.length,this.isIndeterminate=t>0&&t<this.curFileList.length},handleDownload:function(){var e=this;console.log("in handleDownload"),this.selected.forEach(function(t){return e.$store.dispatch("downloadFile",t.id).then(function(o){if(console.log("in handleDownload -> res:"),console.log(o),"application/json"===o.data.type)e.$message({type:"error",message:"下载失败，文件不存在或权限不足"});else if(window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(blob,t.fileName);else{var n=window.URL.createObjectURL(new Blob([o.data])),i=document.createElement("a");i.style.display="none",i.href=n,i.setAttribute("download",t.filename),document.body.appendChild(i),i.click()}e.$message({message:"下载成功",type:"success"})}).catch(function(t){console.log(t),e.$message.error("下载失败，请刷新后重试")})})},handleDelete:function(){var e=this;console.log("in handleDelete"),this.selected.forEach(function(t){return e.$store.dispatch("deleteFile",t.id).then(function(t){e.$message({message:"删除成功",type:"success"}),e.reload()}).catch(function(t){e.$message.error("删除失败，请刷新后重试")})})},handleShare:function(){if(this.selected.length>1)this.$message.error("只能选中一个");else{var e=this.selected[0];"dir"==e.type_of_node?this.$message.error("暂时不支持分享目录"):(this.shareForm.id=e.id,this.dialogFormVisible=!0)}},newShare:function(){var e=this;this.dialogFormVisible=!1,this.$store.dispatch("shareFile",this.shareForm).then(function(t){console.log("new share success -> res: "),console.log(t);var o=t.data.data.share.share_url,n=t.data.data.share.share_token;console.log(o),console.log(n),e.$message({message:"分享成功",type:"sucess"}),e.reload()}).catch(function(t){e.$message.error("分享失败")})},handleShowShare:function(){if(this.selected.length>1)this.$message.error("只能选中一个");else{var e=this.selected[0];if("dir"==e)this.$message.error("暂时不支持分享目录");else{var t=e.shares;this.shares=t,console.log("method : handleShowShare -> this.shares: "),console.log(this.shares),this.dialogTableVisible=!0}}},toggleSelection:function(e){var t=this;e?(console.log("in toggleSelection -> rows"),console.log(e),e.forEach(function(e){t.$refs.multipleTable.toggleRowSelection(e)})):(console.log("in toggleSelection -> not rows"),console.log(e),this.$refs.multipleTable.clearSelection())},handleSelectionChange:function(e){this.multipleSelection=e},handleDeleteShare:function(){var e=this;console.log(this.multipleSelection),this.multipleSelection.forEach(function(t){return e.$store.dispatch("deleteShare",t.share_id).then(function(t){e.$message({message:"删除成功",type:"sucess"}),e.reload()}).catch(function(t){e.$message.error("删除失败")})})},beginTimeFormatter:function(e,t){return new Date(1e3*parseInt(e.share_begin_time)).toLocaleString().replace(/:\d{1,2}$/," ")},endTimeFormatter:function(e,t){return new Date(1e3*parseInt(e.share_end_time)).toLocaleString().replace(/:\d{1,2}$/," ")},URLFormatter:function(e,t){return"http://bytescloud.cn/share/"+e.share_url}}),E),q={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{staticClass:"toolBar"},[o("b-breadcrumb",e._l(e.pathItems,function(t){return o("b-breadcrumb-item",{key:t.to.id,attrs:{text:t.text},on:{click:function(o){return e.changeCurFileID(t.to.id,t.to.path)}}})}),1),e._v(" "),o("div",[o("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),e._v(" "),o("el-button-group",[o("el-button",{attrs:{type:e.nameType,icon:"el-icon-sort-down"},on:{click:e.handleNameSort}}),e._v(" "),o("el-button",{attrs:{type:e.timeType,icon:"el-icon-time"},on:{click:e.handleTimeSort}})],1),e._v(" "),o("el-button-group",[e.selectedLength>0?o("el-button",{attrs:{type:"primary",icon:"el-icon-delete"},on:{click:e.handleDelete}},[e._v("删除")]):e._e(),e._v(" "),e.selectedLength>0?o("el-button",{attrs:{type:"primary",icon:"el-icon-download"},on:{click:e.handleDownload}},[e._v("下载")]):e._e(),e._v(" "),e.selectedLength>0?o("el-button",{attrs:{type:"primary",icon:"el-icon-share"},on:{click:e.handleShare}},[e._v("分享")]):e._e(),e._v(" "),e.selectedLength>0?o("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:e.handleShowShare}},[e._v("查看分享链接")]):e._e()],1),e._v(" "),o("el-button",{attrs:{icon:"el-icon-plus"},on:{click:function(t){e.dialogNewFolderFormVisible=!0}}},[e._v("新建文件夹")]),e._v(" "),o("el-button",{attrs:{icon:"el-icon-upload"},on:{click:function(t){e.dialogUploadFormVisible=!0}}},[e._v("上传文件")])],1)],1),e._v(" "),o("el-divider"),e._v(" "),o("el-container",{staticStyle:{height:"400px",border:"1px solid #eee"}},[o("el-main",[o("el-checkbox-group",{on:{change:e.handleSelectedChange},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.curFileList,function(e){return o("el-checkbox",{key:e.id,attrs:{label:e}},[o("file-item",{attrs:{file:e}})],1)}),1)],1)],1),e._v(" "),o("el-divider"),e._v(" "),o("el-dialog",{attrs:{width:"30%",title:"新建文件夹",visible:e.dialogNewFolderFormVisible},on:{"update:visible":function(t){e.dialogNewFolderFormVisible=t}}},[o("el-form",{attrs:{model:e.newFolderForm}},[o("el-form-item",{attrs:{label:"文件夹名称","label-width":e.formLabelWidth}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:e.newFolderForm.newFolderName,callback:function(t){e.$set(e.newFolderForm,"newFolderName",t)},expression:"newFolderForm.newFolderName "}})],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogNewFolderFormVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.commitNew}},[e._v("确 定")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"上传",visible:e.dialogUploadFormVisible,width:"30%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogUploadFormVisible=t}}},[o("div",[o("b-form-file",{attrs:{state:Boolean(e.file),placeholder:"Choose a file or drop it here...","drop-placeholder":"Drop file here..."},model:{value:e.file,callback:function(t){e.file=t},expression:"file"}}),e._v(" "),o("div",{staticClass:"mt-3"},[e._v("Selected file: "+e._s(e.file?e.file.name:""))])],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogUploadFormVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.submitUpload}},[e._v("确 定")])],1)]),e._v(" "),o("el-dialog",{attrs:{title:"分享文件",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[o("el-form",{attrs:{model:e.shareForm}},[o("el-form-item",{attrs:{label:"是否需要密码","label-width":e.formLabelWidth}},[o("el-radio",{attrs:{label:"0"},model:{value:e.shareForm.token_required,callback:function(t){e.$set(e.shareForm,"token_required",t)},expression:"shareForm.token_required"}},[e._v("不需要")]),e._v(" "),o("el-radio",{attrs:{label:"1"},model:{value:e.shareForm.token_required,callback:function(t){e.$set(e.shareForm,"token_required",t)},expression:"shareForm.token_required"}},[e._v("需要")])],1),e._v(" "),o("el-form-item",{attrs:{label:"失效时间","label-width":e.formLabelWidth}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:e.shareForm.day,callback:function(t){e.$set(e.shareForm,"day",t)},expression:"shareForm.day"}})],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.newShare}},[e._v("确 定")])],1)],1),e._v(" "),o("el-dialog",{attrs:{width:"70%",title:"已经分享的链接",visible:e.dialogTableVisible},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[o("el-table",{ref:"multipleTable",attrs:{data:e.shares,"max-height":"400","default-sort":{prop:"share_begin_time",order:"descending"}},on:{"selection-change":e.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),o("el-table-column",{attrs:{sortable:"",property:"share_begin_time",label:"开始日期",formatter:e.beginTimeFormatter,width:"150"}}),e._v(" "),o("el-table-column",{attrs:{sortable:"",property:"share_end_time",label:"失效日期",formatter:e.endTimeFormatter,width:"150"}}),e._v(" "),o("el-table-column",{attrs:{property:"share_url",label:"链接",formatter:e.URLFormatter,width:"400"}}),e._v(" "),o("el-table-column",{attrs:{property:"share_token",label:"密钥"}})],1),e._v(" "),o("div",{staticStyle:{"margin-top":"20px"}},[o("el-button",{on:{click:function(t){return e.toggleSelection()}}},[e._v("取消选择")]),e._v(" "),o("el-button",{on:{click:function(t){return e.handleDeleteShare()}}},[e._v("删除链接")])],1)],1)],1)},staticRenderFns:[]};var A,P=o("VU/8")(N,q,!1,function(e){o("YQET")},null,null).exports,j=(A={name:"all-files",components:{},props:{nodeType:{type:String,required:!0}},inject:["reload"],data:function(){var e;return e={checkAll:!1,isIndeterminate:!0,newFolderTab:!0,uploadTab:!1,selected:[],shareForm:{id:-1,token_required:0,day:1},newFolderForm:{newFolderName:""},file:null,formLabelWidth:"120px",dialogFormVisible:!1,dialogTableVisible:!1,dialogNewFolderFormVisible:!1,dialogUploadFormVisible:!1},U()(e,"formLabelWidth","120px"),U()(e,"shares",[]),U()(e,"multipleSelection",[]),U()(e,"nameType",""),U()(e,"timeType","primary"),U()(e,"sortType","time"),e}},U()(A,"components",{FileItem:I}),U()(A,"created",function(){console.log("created FileContainer"),this.$store.dispatch("getAllFiles")}),U()(A,"computed",{curFileList:function(){var e=this;return"name"==this.sortType?(console.log("sortType == name"),this.$store.getters.curFileList.filter(function(t){return e.getType(t.type_of_node)==e.nodeType}).sort(function(e,t){return e.filename>t.filename?1:-1})):"time"==this.sortType?(console.log("sortType == time"),this.$store.getters.curFileList.filter(function(t){return e.getType(t.type_of_node)==e.nodeType}).sort(function(e,t){return e.upload_time-t.upload_time})):void 0},pathItems:function(){return console.log("computed pathItems"),console.log(this.$store.getters.curPathItems),this.$store.getters.curPathItems},anyRemaining:function(){return this.$store.getters.anyRemaining},selectedLength:function(){return this.selected.length}}),U()(A,"methods",{handleNameSort:function(){this.nameType="primary",this.timeType="",this.sortType="name",console.log(this.sortType)},handleTimeSort:function(){this.nameType="",this.timeType="primary",this.sortType="time",console.log(this.sortType)},changeCurFileID:function(e,t){this.$store.dispatch("changeCurFileID",e),this.$store.dispatch("changePathItems",e),this.$router.push(t).catch(function(e){}),this.emptyChecked()},commitNew:function(){var e=this;this.$store.dispatch("commitNew",{curID:this.id,newFile:this.newFolderForm.newFolderName}).then(function(t){e.$message({message:"新建成功",type:"success"}),e.reload()}),this.$store.dispatch("getAllFiles")},cancelNew:function(){this.newFile=""},submitUpload:function(){var e=this;this.file&&(console.log("submitUpload:"),console.log(this.id),console.log(this.file),this.$store.dispatch("submitUpload",{curID:this.id,file:this.file}).then(function(t){e.$message({message:"上传成功",type:"success"}),e.reload()}).toLocaleString(function(e){}))},handleClose:function(e){this.$confirm("确认关闭？").then(function(t){e()}).catch(function(e){})},handleCheckAllChange:function(e){this.selected=e?this.curFileList:[],this.isIndeterminate=!1},handleSelectedChange:function(e){var t=e.length;this.checkAll=t===this.curFileList.length,this.isIndeterminate=t>0&&t<this.curFileList.length},handleDownload:function(){var e=this;console.log("in handleDownload"),this.selected.forEach(function(t){return e.$store.dispatch("downloadFile",t.id).then(function(o){if(console.log("in handleDownload -> res:"),console.log(o),"application/json"===o.data.type)e.$message({type:"error",message:"下载失败，文件不存在或权限不足"});else if(window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(blob,t.fileName);else{var n=window.URL.createObjectURL(new Blob([o.data])),i=document.createElement("a");i.style.display="none",i.href=n,i.setAttribute("download",t.filename),document.body.appendChild(i),i.click()}e.$message({message:"下载成功",type:"success"})}).catch(function(t){console.log(t),e.$message.error("下载失败，请刷新后重试")})})},handleDelete:function(){var e=this;console.log("in handleDelete"),this.selected.forEach(function(t){return e.$store.dispatch("deleteFile",t.id).then(function(t){e.$message({message:"删除成功",type:"success"}),e.reload()}).catch(function(t){e.$message.error("删除失败，请刷新后重试")})})},handleShare:function(){if(this.selected.length>1)this.$message.error("只能选中一个");else{var e=this.selected[0];"dir"==e.type_of_node?this.$message.error("暂时不支持分享目录"):(this.shareForm.id=e.id,this.dialogFormVisible=!0)}},newShare:function(){var e=this;this.dialogFormVisible=!1,this.$store.dispatch("shareFile",this.shareForm).then(function(t){console.log("new share success -> res: "),console.log(t);var o=t.data.data.share.share_url,n=t.data.data.share.share_token;console.log(o),console.log(n),e.$message({message:"分享成功",type:"sucess"}),e.reload()}).catch(function(t){e.$message.error("分享失败")})},handleShowShare:function(){if(this.selected.length>1)this.$message.error("只能选中一个");else{var e=this.selected[0];if("dir"==e)this.$message.error("暂时不支持分享目录");else{var t=e.shares;this.shares=t,console.log("method : handleShowShare -> this.shares: "),console.log(this.shares),this.dialogTableVisible=!0}}},toggleSelection:function(e){var t=this;e?(console.log("in toggleSelection -> rows"),console.log(e),e.forEach(function(e){t.$refs.multipleTable.toggleRowSelection(e)})):(console.log("in toggleSelection -> not rows"),console.log(e),this.$refs.multipleTable.clearSelection())},handleSelectionChange:function(e){this.multipleSelection=e},handleDeleteShare:function(){var e=this;console.log(this.multipleSelection),this.multipleSelection.forEach(function(t){return e.$store.dispatch("deleteShare",t.share_id).then(function(t){e.$message({message:"删除成功",type:"sucess"}),e.reload()}).catch(function(t){e.$message.error("删除失败")})})},beginTimeFormatter:function(e,t){return new Date(1e3*parseInt(e.share_begin_time)).toLocaleString().replace(/:\d{1,2}$/," ")},endTimeFormatter:function(e,t){return new Date(1e3*parseInt(e.share_end_time)).toLocaleString().replace(/:\d{1,2}$/," ")},URLFormatter:function(e,t){return this.$store.getters.targetHost+"/#/share/"+e.share_url},getType:function(e){return"JPG"==e||"jpg"==e||"JPEG"==e||"jpeg"==e||"PNG"==e||"png"==e||"GIF"==e||"gif"==e?"img":"mp3"==e||"wav"==e||"wma"==e||"rm"==e||"m4a"==e?"music":"flv"==e||"avi"==e||"mov"==e||"mp4"==e||"wmv"==e?"video":"dir"==e?"dir":"doc"}}),A),O={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{staticClass:"toolBar"},[o("el-divider"),e._v(" "),o("div",[o("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),e._v(" "),o("el-button-group",[o("el-button",{attrs:{type:e.nameType,icon:"el-icon-sort-down"},on:{click:e.handleNameSort}}),e._v(" "),o("el-button",{attrs:{type:e.timeType,icon:"el-icon-time"},on:{click:e.handleTimeSort}})],1),e._v(" "),o("el-button-group",[e.selectedLength>0?o("el-button",{attrs:{type:"primary",icon:"el-icon-delete"},on:{click:e.handleDelete}},[e._v("删除")]):e._e(),e._v(" "),e.selectedLength>0?o("el-button",{attrs:{type:"primary",icon:"el-icon-download"},on:{click:e.handleDownload}},[e._v("下载")]):e._e(),e._v(" "),e.selectedLength>0?o("el-button",{attrs:{type:"primary",icon:"el-icon-share"},on:{click:e.handleShare}},[e._v("分享")]):e._e(),e._v(" "),e.selectedLength>0?o("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:e.handleShowShare}},[e._v("查看分享链接")]):e._e()],1)],1)],1),e._v(" "),o("el-divider"),e._v(" "),o("el-container",{staticStyle:{height:"400px",border:"1px solid #eee"}},[o("el-main",[o("el-checkbox-group",{on:{change:e.handleSelectedChange},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.curFileList,function(e){return o("el-checkbox",{key:e.id,attrs:{label:e}},[o("file-item",{attrs:{file:e}})],1)}),1)],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"新建文件夹",visible:e.dialogNewFolderFormVisible},on:{"update:visible":function(t){e.dialogNewFolderFormVisible=t}}},[o("el-form",{attrs:{model:e.newFolderForm}},[o("el-form-item",{attrs:{label:"文件夹名称","label-width":e.formLabelWidth}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:e.newFolderForm.newFolderName,callback:function(t){e.$set(e.newFolderForm,"newFolderName",t)},expression:"newFolderForm.newFolderName "}})],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogNewFolderFormVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.commitNew}},[e._v("确 定")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"上传",visible:e.dialogUploadFormVisible,width:"30%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogUploadFormVisible=t}}},[o("div",[o("b-form-file",{attrs:{state:Boolean(e.file),placeholder:"Choose a file or drop it here...","drop-placeholder":"Drop file here..."},model:{value:e.file,callback:function(t){e.file=t},expression:"file"}}),e._v(" "),o("div",{staticClass:"mt-3"},[e._v("Selected file: "+e._s(e.file?e.file.name:""))])],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogUploadFormVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.submitUpload}},[e._v("确 定")])],1)]),e._v(" "),o("el-dialog",{attrs:{title:"分享文件",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[o("el-form",{attrs:{model:e.shareForm}},[o("el-form-item",{attrs:{label:"是否需要密码","label-width":e.formLabelWidth}},[o("el-radio",{attrs:{label:"0"},model:{value:e.shareForm.token_required,callback:function(t){e.$set(e.shareForm,"token_required",t)},expression:"shareForm.token_required"}},[e._v("不需要")]),e._v(" "),o("el-radio",{attrs:{label:"1"},model:{value:e.shareForm.token_required,callback:function(t){e.$set(e.shareForm,"token_required",t)},expression:"shareForm.token_required"}},[e._v("需要")])],1),e._v(" "),o("el-form-item",{attrs:{label:"失效时间","label-width":e.formLabelWidth}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:e.shareForm.day,callback:function(t){e.$set(e.shareForm,"day",t)},expression:"shareForm.day"}})],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.newShare}},[e._v("确 定")])],1)],1),e._v(" "),o("el-dialog",{attrs:{width:"70%",title:"已经分享的链接",visible:e.dialogTableVisible},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[o("el-table",{ref:"multipleTable",attrs:{data:e.shares,"max-height":"400","default-sort":{prop:"share_begin_time",order:"descending"}},on:{"selection-change":e.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),o("el-table-column",{attrs:{sortable:"",property:"share_begin_time",label:"开始日期",formatter:e.beginTimeFormatter,width:"150"}}),e._v(" "),o("el-table-column",{attrs:{sortable:"",property:"share_end_time",label:"失效日期",formatter:e.endTimeFormatter,width:"150"}}),e._v(" "),o("el-table-column",{attrs:{property:"share_url",label:"链接",formatter:e.URLFormatter,width:"400"}}),e._v(" "),o("el-table-column",{attrs:{property:"share_token",label:"密钥"}})],1),e._v(" "),o("div",{staticStyle:{"margin-top":"20px"}},[o("el-button",{on:{click:function(t){return e.toggleSelection()}}},[e._v("取消选择")]),e._v(" "),o("el-button",{on:{click:function(t){return e.handleDeleteShare()}}},[e._v("删除链接")])],1)],1)],1)},staticRenderFns:[]};var z=o("VU/8")(j,O,!1,function(e){o("9NRs")},null,null).exports,W=o("TaX5");n.default.use(s.a);var B=new s.a({mode:"history",routes:[{path:"*",component:W.default},{path:"/",redirect:"/home/files/-1"},{path:"/home",name:"Home",component:p,meta:{requiresAuth:!0},children:[{path:"files",redirect:"/home/files/-1"},{path:":nodeType",name:"Filter",component:z,props:!0,meta:{requiresAuth:!0}},{path:"demo/:id",name:"FileContainer",component:R,props:!0,meta:{requiresAuth:!0}},{path:"files/:id",name:"AllFiles",component:P,props:!0,meta:{requiresAuth:!0}},{path:"demo",redirect:"/home/demo/-1"}]},{path:"/share/:shareUrl",name:"Share",component:C,props:!0},{path:"/login",name:"Login",component:b,meta:{requiresVisitor:!0}},{path:"/register",name:"Register",component:k,meta:{requiresVisitor:!0}},{path:"/logout",name:"Logout",component:w,meta:{requiresAuth:!0}}]}),H=o("ppUw"),G=o.n(H),M=o("K/Lq"),J=o.n(M),Q=o("Tqaz"),Y=(o("Jmt5"),o("9M+g"),o("zL8q")),X=o.n(Y),Z=(o("tvR6"),o("//Fk")),K=o.n(Z),ee=o("NYxO"),te=o("mtWM"),oe=o.n(te);n.default.use(ee.a),oe.a.defaults.baseURL="http://127.0.0.1:8000/api",oe.a.defaults.withCredentials=!0;var ne=new ee.a.Store({state:{email:localStorage.getItem("email")||null,files:[],token:localStorage.getItem("token")||"",curFileID:-1,curPathItems:[{text:"/root",to:{name:"FileContainer",path:"/home/files/-1",id:"-1"}}]},getters:{loggedIn:function(e){return null!==e.email},curFileList:function(e){var t=e.files.filter(function(t){return t.parent_id==e.curFileID});return e.remainingCount=t.length,t},curPathItems:function(e){return console.log("get curPathItems"),console.log(e.curPathItems),e.curPathItems},curEmail:function(e){return e.email},token:function(e){return e.token},targetHost:function(e){return"http://127.0.0.1:8000"}},mutations:{refreshEmail:function(e,t){e.email=t},deleteEmail:function(e){e.email=null},refreshFiles:function(e,t){e.files=t},refreshToken:function(e,t){e.token=t},deleteToken:function(e){e.token=""},changeCurFileID:function(e,t){e.curFileID=t},changePathItems:function(e,t){if(console.log("in changePathItems"),console.log(t),-1!=e.curPathItems.findIndex(function(e){return e.to.id==t})){console.log("in if");var o=e.curPathItems.findIndex(function(e){return e.to.id==t});e.curPathItems.splice(o+1)}else{console.log("in else :"),console.log(t);var n={text:e.files.filter(function(e){return e.id==t})[0].filename,to:{name:"FileContainer",path:"/home/files/"+t,id:t}};e.curPathItems.push(n)}},clearCurPathItems:function(e){e.curPathItems=[{text:"/root",to:{name:"FileContainer",path:"/home/files/-1",id:"-1"}}]}},actions:{login:function(e,t){return new K.a(function(o,n){oe.a.post("/login",{email:t.email,password:t.password}).then(function(t){console.log(t);var n=t.data.data.user.email;e.commit("refreshEmail",n),localStorage.setItem("email",n),o(t)}).catch(function(e){console.log(e),n(e)})})},logout:function(e){if(e.getters.loggedIn)return new K.a(function(t,o){oe.a.get("/logout").then(function(o){localStorage.removeItem("email"),e.commit("deleteEmail"),localStorage.removeItem("token"),e.commit("deleteToken"),t(o)}).catch(function(t){localStorage.removeItem("email"),e.commit("deleteEmail"),localStorage.removeItem("token"),e.commit("deleteToken"),o(t)})})},register:function(e,t){return new K.a(function(e,o){oe.a.post("/register",{email:t.email,password:t.password}).then(function(t){alert("success"),e(t)}).catch(function(e){o(e)})})},saveToken:function(e,t){localStorage.setItem("token",t),e.commit("refreshToken",t)},getAllFiles:function(e){return new K.a(function(t,o){oe.a.get("/file/all").then(function(o){console.log("action: get all files"),console.log(o);var n=o.data.data.files;e.commit("refreshFiles",n),t(o)}).catch(function(e){console.log(e),o(e)})})},changeCurFileID:function(e,t){console.log("context commit changecurfileid",t),e.commit("changeCurFileID",t)},changePathItems:function(e,t){console.log("context commit changePathItems",t),e.commit("changePathItems",t)},finishedEdit:function(e,t){return new K.a(function(e,o){oe.a.post("/file/reName",{id:t.id,newName:t.newName}).then(function(t){e(t)}).catch(function(e){console.log(e),o(e)})})},commitNew:function(e,t){return new K.a(function(e,o){oe.a.post("/file/newFolder",{curId:t.curID,foldername:t.newFile}).then(function(t){e(t)}).catch(function(e){console.log(e),o(e)})})},submitUpload:function(e,t){var o={headers:{"Content-Type":"multipart/form-data"}};console.log("action: submit upload"),console.log(t.file);var n=new FormData;return n.append("curId",t.curID),n.append("file",t.file),console.log("action: submit upload"),console.log(n),new K.a(function(e,t){oe.a.post("/file/upload",n,o).then(function(t){e(t)}).catch(function(e){console.log(e),t(e)})})},deleteFile:function(e,t){return new K.a(function(e,o){oe.a.get("/file/delete?id="+t).then(function(t){e(t)}).catch(function(e){console.log(e),o(e)})})},downloadFile:function(e,t){return new K.a(function(e,o){console.log("action: downloadFile"),oe.a.get("/file/download?id="+t,{responseType:"blob"}).then(function(t){e(t)}).catch(function(e){console.log(e),o(e)})})},shareFile:function(e,t){return new K.a(function(e,o){console.log("action: shareFile"),oe.a.post("/file/share",{id:t.id,token_required:t.token_required,day:t.day}).then(function(t){e(t)}).catch(function(e){o(e)})})},deleteShare:function(e,t){return new K.a(function(e,o){console.log("action: shareFile"),oe.a.post("file/share/cancel",{share_id:t}).then(function(t){e(t)}).catch(function(e){o(e)})})},getShareFileInfo:function(e,t){return new K.a(function(e,o){console.log("action: getShareFileInfo"),oe.a.get("file/share/info/"+t).then(function(t){e(t)}).catch(function(e){o(e)})})},downloadShare:function(e,t){return new K.a(function(e,o){console.log("action: downloadShare"),oe.a.get("/file/share/download/"+t.shareUrl+"?share_token="+t.shareToken,{responseType:"blob"}).then(function(t){e(t)}).catch(function(e){console.log(e),o(e)})})},clearCurPathItems:function(e){e.commit("clearCurPathItems")}}});n.default.use(X.a),n.default.use(Q.a),n.default.use(Q.b),n.default.use(G.a),n.default.use(J.a),n.default.use(B),n.default.config.productionTip=!1,B.beforeEach(function(e,t,o){e.matched.some(function(e){return e.meta.requiresAuth})?ne.getters.loggedIn?(console.log("requiresAuth -> logined"),o()):(console.log("requiresAuth -> not login"),o({path:"/login",query:{redirect:e.fullPath}})):e.matched.some(function(e){return e.meta.requiresVisitor})?ne.getters.loggedIn?(console.log("requiresVisiter -> logined"),o({path:"/files/-1",query:{redirect:e.fullPath}})):(console.log("requiresVisiter ->  not logined"),o()):o()}),new n.default({el:"#app",router:B,store:ne,components:{App:l},template:"<App/>"})},TaX5:function(e,t,o){"use strict";var n=o("2vDZ"),i=o.n(n),l=o("sLtD");var s=function(e){o("c3Ss")},r=o("VU/8")(i.a,l.a,!1,s,null,null);t.default=r.exports},YQET:function(e,t){},c3Ss:function(e,t){},j18t:function(e,t){},j1r9:function(e,t){},odLO:function(e,t){},sLtD:function(e,t,o){"use strict";var n={render:function(){var e=this.$createElement;return(this._self._c||e)("h1",[this._v("ohhhh , 404 not found")])},staticRenderFns:[]};t.a=n},tvR6:function(e,t){},uEG4:function(e,t){},vMRt:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.c64f0a58e247ad962cf2.js.map